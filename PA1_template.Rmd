---
title: "Reproducible Research: Peer Assessment 1"
output: 
  html_document:
    keep_md: true
---

```{r init,echo=FALSE,message=FALSE}
dataFileUrl <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
```

Welcome to Reproducible Research Peer Assignment 1.

This assignment makes use of data from a personal activity monitoring
device. This device collects data at 5 minute intervals through out the
day. The data consists of two months of data from an anonymous
individual collected during the months of October and November, 2012
and include the number of steps taken in 5 minute intervals each day.

The time series is already defined by the interval -- 
the interval is an integer rendering of when the activity
(steps) were sampled.  The interval represents time
in form of 24 hour format HHMM.  For integer values of 
less than 4 digits, merely add preceding zeroes to
pad to 4 digits.

For example:

- An interval of 0 == 0000, or 00:00 which is midnight.
- Similarly an interval of 1200 is equivalent to 12:00, or noon.

The time zone is not specified, and not relevant for this study.

We will be exploring patterns for:

- Daily step totals
- Step patterns during intervals over the the entire collection
period
- Step patterns during intervals comparing week (work) days vs. weekend days.

The data is sourced from the course website: 
[Activity monitoring data][1]

## Loading and preprocessing the data
First we download, unzip and load the activity data...

```{r load-data, message=FALSE, results='hide'}
library(data.table)
download.file(dataFileUrl,"activity.zip",method = "curl")
unzip("./activity.zip")
activity.ds <- fread("./activity.csv",header = TRUE)
```

The activity dataset is already in tidy form; however, light preprocessing is done for date handling and cleaning of provided raw data.

```{r clean-data, message=FALSE, results='hide'}
activity.ds$date <- as.Date(activity.ds$date,"%Y-%m-%d")
activity.cleaned.ds <- activity.ds[complete.cases(activity.ds)]
```

## What is mean total number of steps taken per day?

```{r get-days-cleaned, echo=FALSE, message=FALSE, results='hide'}
days.cleaned <- max(activity.cleaned.ds$date) - min(activity.cleaned.ds$date) + 1
```

The following is the histogram of daily (total) steps taken across
the `r days.cleaned` days (cleaned) dataset.

```{r histogram-daily-total-steps-cleaned, message=FALSE}
library(dplyr)
library(ggplot2)
dailyStepSummary.cleaned.ds <- summarize(group_by(activity.cleaned.ds,date),
                     totalSteps = sum(steps))

p <- ggplot(dailyStepSummary.cleaned.ds,
        aes(x = totalSteps)) +
        geom_histogram(binwidth = 5000,
                       colour="blue",
                       fill="white") +
        xlab("Total Daily Steps") +
        ylab("Count (number of days for total step range)") +
        ggtitle("Mean Daily Total Steps")

print(p)
```

The following is the mean and median daily steps taken across
the `r days.cleaned` day (cleaned) dataset.

```{r summary-daily-total-steps-cleaned, message=FALSE, results='asis'}
library(xtable)
x <- xtable(summarize(dailyStepSummary.cleaned.ds, 
          "Median Steps" = median(dailyStepSummary.cleaned.ds$totalSteps),
          "Mean Steps" = mean(dailyStepSummary.cleaned.ds$totalSteps)))
print(x,type = "html")
```

*The data sourced in this section has been "cleaned", or ommitting
activity records with missing data.*

## What is the average daily activity pattern?
The following demonstrates the daily pattern:  The average of all
intervals in each day in the `r days.cleaned` day span of data represented
by source (preliminary cleaned) data set.

Key observations:

1. Waking hours appear to begin shortly after 5 am.
2. Daily peak activity occurs between 8 and 9 am.
3. Relatively consistent activity in day through 7-8 pm, with taper off after.

```{r activity-pattern,message=FALSE}
library(dplyr)
library(ggplot2)
intervalStepMean.ds <- summarize(group_by(activity.cleaned.ds,
                                             interval),
                                    steps = mean(steps))

p <- ggplot(data=intervalStepMean.ds,
            aes(x=interval,y=steps)) +
        geom_line(colour="blue") +
        ylab("Average Steps/Interval for All Days") +
        xlab("Time of Day (HHMM)") +
        ggtitle("Daily Step Pattern") +
        stat_smooth() +
        geom_text(x = 600, y = 200, label = "Daily Peak")

print(p)
```

## Imputing missing values
Some of values are missing (marked as "NA") in the original dataset.
The previous sections results are assessed against the preliminary cleaned
dataset (which excluded NA)

In this section we will identify and "fill in" the "missing" values.

Check for NA date records (there should be zero)...
```{r check-na-dates}
nrow(activity.ds[is.na(activity.ds$date)])
```


Check for NA interval records (there should be zero)...
```{r check-na-intervals}
nrow(activity.ds[is.na(activity.ds$interval)])
```


Check for NA step records (there should be NA values here, we will "fill 
these in")...
```{r check-na-steps}
nrow(activity.ds[is.na(activity.ds$steps)])
```


Now we will "fill in" the NA step data by setting missing values to the
*rounded weekly average of the interval from the clean data set*....

```{r synthesize-missing-steps}
library(dplyr)
activity.cleaned2.ds <- select(activity.ds[is.na(activity.ds$steps)],
                               one_of("interval","date")) %>%
        inner_join(intervalStepMean.ds, 
                   by = "interval") %>%
        select(one_of("steps","date", "interval"))

activity.cleaned2.ds$steps <- round(activity.cleaned2.ds$steps)
activity.cleaned.all.ds <- rbind(activity.cleaned.ds,activity.cleaned2.ds)
```

```{r get-days-all, echo=FALSE, message=FALSE, results='hide'}
days.all <- max(activity.cleaned.all.ds$date) - min(activity.cleaned.ds$date) + 1
```


Let's compare the histogram of daily (total) steps taken across
the `r days.all` day (complete) dataset

```{r histogram-daily-total-steps-all, message=FALSE}
library(dplyr)
dailyStepSummary.filled.ds <- summarize(group_by(activity.cleaned.all.ds,date),
                     totalSteps = sum(steps))

p <- ggplot(dailyStepSummary.filled.ds,
        aes(x = totalSteps)) +
        geom_histogram(binwidth = 5000,
                       colour="blue",
                       fill="white") +
        xlab("Total Daily Steps") +
        ylab("Count (number of days for total step range)") +
        ggtitle("Mean Daily Total Steps")

print(p)
```

The following is the mean and median daily steps taken across
the `r days.all` day (complete) dataset.

```{r summary-daily-total-steps-all, message=FALSE, results='asis'}
library(dplyr)
library(xtable)
x <- xtable(summarize(dailyStepSummary.filled.ds, 
          "Median Steps" = median(dailyStepSummary.filled.ds$totalSteps),
          "Mean Steps" = mean(dailyStepSummary.filled.ds$totalSteps)))
print(x,type = "html")
```

```{r get-count15k, echo=FALSE, message=FALSE}
count15K.filled <- length(dailyStepSummary.filled.ds$totalSteps[
                dailyStepSummary.filled.ds$totalSteps > 10000 &
                dailyStepSummary.filled.ds$totalSteps <= 15000])

count15K.cleaned <- length(dailyStepSummary.cleaned.ds$totalSteps[
                dailyStepSummary.cleaned.ds$totalSteps > 10000 &
                dailyStepSummary.cleaned.ds$totalSteps <= 15000])
```


You will notice the fill-in of missing data does not significantly impact
either the median and mean totals, HOWEVER, there is a notable increase in frequency of days with total steps between 10K->15K (from `r count15K.cleaned`
->`r count15K.filled`)

## Are there differences in activity patterns between weekdays and weekends?
The following demonstrates the daily pattern comparison between weekdays, and weekends (based from Western workday weekly calendar):  Each chart is the average of all intervals in each weekday/weekend set in the `r days.all` day span of data represented by (complete) data set.

Key comparative observations:

1. Waking hours appear to begin shortly after 5 am for both weekdays and weekends,
but the level of activity increase is faster for weekdays.
2. Daily peak activity occurs between 8 and 9 am for both weekdays and weekends,
but the peak is lower and spread more on the weekends.
3. The overall activity trend comparison is that weekends days have more consistent
activity level during waking hours than on weekdays, and that weekends see relative
slight increase between end of peak and daylight hours (~10 am - 7pm)
4. Slight evening peak during weekdays (~6:30-7 pm)
5. Both weekend and weekday see activity taper off after 8 pm.

```{r activity-pattern-diff,message=FALSE}
library(dplyr)
library(ggplot2)
weekendDays <- c("Saturday","Sunday")

activity.cleaned.all.ds$dayType[weekdays(activity.cleaned.all.ds$date) %in% weekendDays] <- "weekend"
activity.cleaned.all.ds$dayType[!(weekdays(activity.cleaned.all.ds$date) %in% weekendDays)] <- "weekday"

weeklyIntervalStepMean.ds <- summarize(group_by(activity.cleaned.all.ds,
                                             dayType,interval),
                                    steps = mean(steps))

annotation.df <- data.frame(x = c(600,600,2150), 
                            y = c(180,225,125), 
                            dayType = c("weekend","weekday","weekday"), 
                            label = c("Daily Peak", "Daily Peak", "Evening Peak"))

p <- ggplot(data=weeklyIntervalStepMean.ds,
            aes(x=interval,y=steps)) +
        geom_line(colour="blue") +
        facet_wrap(~ dayType, nrow = 2) +
        ylab("Average Steps/Interval for All Days") +
        xlab("Time of Day (HHMM)") +
        ggtitle("Daily Step Pattern") +
        stat_smooth() +
        geom_text(aes(x, y, label=label),data=annotation.df)

print(p)
```

[1]: `r dataFileUrl` Activity monitoring data